<!-- Positions Table Component -->
<div class="positions-table-container">
    <!-- No Position State -->
    <div id="noPositionState" class="text-center py-8 text-gray-500" style="display: none;">
        <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-4 text-gray-400"></i>
        <p class="text-lg font-medium">오픈 포지션 없음</p>
        <p class="text-sm">현재 진입한 포지션이 없습니다.</p>
    </div>

    <!-- Positions Table -->
    <table class="neo-table" id="positionsTableContent" style="display: none;">
        <thead>
            <tr>
                <th>심볼</th>
                <th>수량</th>
                <th>진입가 (KRW)</th>
                <th>현재가 (KRW)</th>
                <th>손익</th>
            </tr>
        </thead>
        <tbody id="positionsTableBody">
            <!-- Populated by JavaScript -->
        </tbody>
    </table>

    <!-- Invested Amounts Summary -->
    <div class="mt-4 pt-4 border-t border-gray-200" id="investedSummary" style="display: none;">
        <div class="grid grid-cols-3 gap-4 text-sm">
            <div>
                <span class="text-gray-500">업비트 매수</span>
                <div class="font-mono font-semibold" id="upbitInvested">₩0</div>
            </div>
            <div>
                <span class="text-gray-500">바이낸스 진입</span>
                <div class="font-mono font-semibold" id="binanceInvested">₩0</div>
            </div>
            <div>
                <span class="text-gray-500">총 투자금</span>
                <div class="font-mono font-semibold text-lg" id="totalInvestedDetail">₩0</div>
            </div>
        </div>
    </div>
</div>

<script>
function updatePositionsTable(data) {
    const noPosition = document.getElementById('noPositionState');
    const table = document.getElementById('positionsTableContent');
    const tbody = document.getElementById('positionsTableBody');
    const summary = document.getElementById('investedSummary');

    if (!data || !data.has_position || !data.positions || data.positions.length === 0) {
        noPosition.style.display = 'block';
        table.style.display = 'none';
        summary.style.display = 'none';
        return;
    }

    noPosition.style.display = 'none';
    table.style.display = 'table';
    summary.style.display = 'block';

    // Build table rows
    let html = '';
    data.positions.forEach(pos => {
        const pnlClass = pos.pnl >= 0 ? 'profit' : 'loss';
        const pnlSign = pos.pnl >= 0 ? '+' : '';
        html += `
            <tr>
                <td>${pos.symbol || 'BTC'}</td>
                <td>${pos.quantity?.toFixed(6) || '-'}</td>
                <td>₩${(pos.entry_price || 0).toLocaleString()}</td>
                <td>₩${(pos.current_price || 0).toLocaleString()}</td>
                <td class="${pnlClass}">${pnlSign}${(pos.pnl || 0).toFixed(2)}%</td>
            </tr>
        `;
    });
    tbody.innerHTML = html;

    // Update invested amounts
    document.getElementById('upbitInvested').textContent =
        `₩${(data.upbit_invested || 0).toLocaleString()}`;
    document.getElementById('binanceInvested').textContent =
        `₩${(data.binance_invested_krw || 0).toLocaleString()}`;
    document.getElementById('totalInvestedDetail').textContent =
        `₩${(data.total_invested_krw || 0).toLocaleString()}`;
}
</script>
